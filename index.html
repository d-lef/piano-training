<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Note Trainer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='5' y='20' width='90' height='60' rx='4' fill='%23333'/><rect x='10' y='25' width='11' height='50' fill='white' rx='2'/><rect x='23' y='25' width='11' height='50' fill='white' rx='2'/><rect x='36' y='25' width='11' height='50' fill='white' rx='2'/><rect x='49' y='25' width='11' height='50' fill='white' rx='2'/><rect x='62' y='25' width='11' height='50' fill='white' rx='2'/><rect x='75' y='25' width='11' height='50' fill='white' rx='2'/><rect x='17' y='25' width='8' height='30' fill='%23333' rx='1'/><rect x='30' y='25' width='8' height='30' fill='%23333' rx='1'/><rect x='56' y='25' width='8' height='30' fill='%23333' rx='1'/><rect x='69' y='25' width='8' height='30' fill='%23333' rx='1'/><rect x='82' y='25' width='8' height='30' fill='%23333' rx='1'/></svg>">
    <link rel="stylesheet" href="style.css?v=25">
    <script src="https://unpkg.com/vexflow@4.2.3/build/cjs/vexflow.js"></script>
</head>
<body>
    <!-- Rotate Phone Overlay (mobile portrait only) -->
    <div id="rotate-overlay">
        <div class="rotate-icon">↻</div>
        <div class="rotate-text">Rotate your phone to landscape</div>
    </div>

    <a href="help.html" id="help-btn" title="Help &amp; Instructions">?</a>
    <a href="https://buymeacoffee.com/daniel_l" target="_blank" id="coffee-btn" title="Buy me a coffee">☕</a>
    <button id="settings-btn" title="Settings"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></button>
    <button id="stats-btn" title="Statistics"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg></button>
    <button id="theme-btn" title="Toggle dark/light theme">☾</button>

    <!-- Mobile Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Settings</span>
                <button id="close-settings-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="mobile-settings-container">
                <!-- Settings will be cloned here on mobile -->
            </div>
        </div>
    </div>

    <!-- Mobile Stats Modal -->
    <div id="stats-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Statistics</span>
                <button id="close-stats-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="mobile-stats-container">
                <!-- Stats will be cloned here on mobile -->
            </div>
        </div>
    </div>
    <div id="app">
        <!-- Settings Panel -->
        <div id="settings-panel">
            <div class="setting-group">
                <label title="Note naming style/language">Notes:</label>
                <select id="naming-style-select" title="Choose how note names are displayed"></select>
            </div>
            <div class="setting-group">
                <label title="Which clef to display notes on">Clef:</label>
                <select id="clef-select" title="Treble (G clef), Bass (F clef), or both randomly">
                    <option value="treble">Treble</option>
                    <option value="bass">Bass</option>
                    <option value="both">Both</option>
                </select>
            </div>
            <div class="setting-group">
                <label title="Limit which notes appear in training">Range:</label>
                <select id="range-min" title="Lowest note to practice"></select>
                <span>to</span>
                <select id="range-max" title="Highest note to practice"></select>
            </div>
            <div class="setting-group">
                <label class="toggle" title="Show the note name below the staff">
                    <input type="checkbox" id="show-note-names">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Note hints</span>
                </label>
            </div>
            <div class="setting-group">
                <label class="toggle" title="Show note names on piano keys">
                    <input type="checkbox" id="keyboard-labels-toggle">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Key labels</span>
                </label>
            </div>
            <div class="setting-group">
                <label class="toggle" title="Include sharps and flats (C#, D#, etc.)">
                    <input type="checkbox" id="accidentals-toggle">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Accidentals</span>
                </label>
            </div>
            <div class="setting-group">
                <label class="toggle" title="Show response time counter (still tracks in background when hidden)">
                    <input type="checkbox" id="timer-toggle">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Timer</span>
                </label>
            </div>
            <div class="setting-group">
                <label class="toggle" title="Play piano sound when keys are pressed">
                    <input type="checkbox" id="sound-toggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Sound</span>
                </label>
            </div>
        </div>

        <!-- Main Layout with Side Panel -->
        <div id="main-layout">
            <!-- Side Panels (Left) -->
            <div id="side-panels">
                <div id="misses-panel">
                    <div class="panel-title">Mistakes</div>
                    <div class="panel-empty">None yet</div>
                </div>
                <div id="slowest-panel">
                    <div class="panel-title">Slowest</div>
                    <div class="panel-empty">None yet</div>
                </div>
                <button id="clear-stats-btn" title="Clear mistakes and slowest statistics (resets smart repetition)">Clear Stats</button>
            </div>

            <!-- Center Content -->
            <div id="center-content">
                <!-- Score Strip -->
                <div id="score-strip">
                    <div class="score-item">
                        <span class="label">Correct:</span>
                        <span id="correct-count">0</span>
                    </div>
                    <div class="score-item">
                        <span class="label">Wrong:</span>
                        <span id="wrong-count">0</span>
                    </div>
                    <div class="score-item">
                        <span class="label">Accuracy:</span>
                        <span id="accuracy">--%</span>
                    </div>
                    <div class="score-item">
                        <span class="label">Streak:</span>
                        <span id="streak">0</span>
                    </div>
                    <button id="new-session-btn" title="Reset all scores and start fresh">New Session</button>
                </div>

                <!-- Staff Display -->
                <div id="staff-container">
                    <div id="start-overlay">
                        <button id="start-btn"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18c.62-.39.62-1.29 0-1.69L9.54 5.98C8.87 5.55 8 6.03 8 6.82z"/></svg></button>
                    </div>
                    <button id="pause-toggle-btn" class="hidden" title="Pause/Continue session"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2s2-.9 2-2V7c0-1.1-.9-2-2-2zm8 0c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2s2-.9 2-2V7c0-1.1-.9-2-2-2z"/></svg></button>
                    <div id="staff"></div>
                    <div id="staff-footer">
                        <div id="note-label"></div>
                        <div id="timer">0.0s</div>
                    </div>
                </div>

                <!-- Feedback Overlay -->
                <div id="feedback" class="hidden"></div>

                <!-- Piano Keyboard -->
                <div id="keyboard-container">
                    <div id="keyboard"></div>
                </div>

                <!-- Keyboard Hints -->
                <div id="keyboard-hints">
                    <span>PC Keyboard: Z X C V B N M = white keys (C D E F G A B) | S D G H J = black keys | Arrow Up/Down = octave</span>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Fix mobile viewport height (100vh is unreliable on mobile)
    function setMobileHeight() {
        const vh = window.innerHeight;
        document.documentElement.style.setProperty('--vh', vh + 'px');
        const app = document.getElementById('app');
        if (app && window.innerWidth > window.innerHeight && vh <= 700) {
            app.style.height = vh + 'px';
            app.style.maxHeight = vh + 'px';
        }
    }
    setMobileHeight();
    window.addEventListener('resize', setMobileHeight);
    window.addEventListener('orientationchange', () => setTimeout(setMobileHeight, 100));
    </script>
    <script src="notes.js?v=4"></script>
    <script src="staff.js?v=4"></script>
    <script src="keyboard.js?v=4"></script>
    <script src="storage.js?v=4"></script>
    <script src="app.js?v=4"></script>
</body>
</html>
